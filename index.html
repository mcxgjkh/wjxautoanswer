<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é—®å·æ˜Ÿè‡ªåŠ¨ç­”é¢˜å™¨ V7.0.1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 1200px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 36px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .header .subtitle {
            color: #8a8aff;
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .header .version {
            color: #666;
            font-size: 14px;
        }
        
        .config-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .config-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 25px;
        }
        
        .config-section h2 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #8a8aff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .config-section h2 i {
            font-size: 20px;
        }
        
        /* é—®å·é“¾æ¥è¾“å…¥æ ·å¼ */
        .url-input {
            margin-bottom: 20px;
        }
        
        .url-prefix {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            color: #ccc;
            font-size: 14px;
        }
        
        .url-prefix .prefix {
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 10px;
            border-radius: 5px;
            margin-right: 10px;
            font-family: 'Consolas', monospace;
        }
        
        .url-input-field {
            display: flex;
            gap: 10px;
        }
        
        .url-input-field input {
            flex: 1;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 14px;
            font-family: 'Consolas', monospace;
        }
        
        .url-input-field input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        /* æ­£ç¡®ç‡æ§åˆ¶æ ·å¼ */
        .accuracy-control {
            margin-bottom: 20px;
        }
        
        .accuracy-slider-container {
            position: relative;
            margin: 20px 0;
        }
        
        .accuracy-slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            outline: none;
        }
        
        .accuracy-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.8);
        }
        
        .accuracy-ticks {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            color: #ccc;
        }
        
        .accuracy-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }
        
        .accuracy-value {
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
            text-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }
        
        .accuracy-info {
            color: #ccc;
            font-size: 12px;
            margin-top: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
        }
        
        /* é¢˜åº“ç®¡ç†æ ·å¼ */
        .bank-manager {
            margin-bottom: 20px;
        }
        
        .bank-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .bank-select {
            flex: 1;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }
        
        .bank-select option {
            background: #1a1a2e;
            color: white;
        }
        
        .bank-buttons {
            display: flex;
            gap: 10px;
        }
        
        .bank-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
            font-size: 22px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .bank-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        .bank-btn.delete {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
        }
        
        .bank-btn.delete:hover {
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
        }
        
        .bank-btn.edit {
            background: linear-gradient(135deg, #2196F3 0%, #0D47A1 100%);
        }
        
        .bank-btn.edit:hover {
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }
        
        .bank-btn.info {
            background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
            width: 30px;
            height: 30px;
            font-size: 16px;
        }
        
        .bank-preview {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .bank-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .bank-stats {
            color: #8a8aff;
            font-size: 14px;
        }
        
        .bank-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .bank-item {
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            font-size: 13px;
            font-family: 'Consolas', monospace;
            border-left: 3px solid #667eea;
            word-break: break-word;
        }
        
        /* é€Ÿåº¦é€‰æ‹©æ ·å¼ */
        .speed-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .speed-option {
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .speed-option:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            background: rgba(102, 126, 234, 0.1);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }
        
        .speed-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }
        
        .speed-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .speed-desc {
            font-size: 12px;
            opacity: 0.8;
        }
        
        /* é¢˜åº“ç¼–è¾‘å™¨æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 1000px;
            max-height: 85vh;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-header h3 {
            color: #8a8aff;
            font-size: 22px;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: #ccc;
            font-size: 28px;
            cursor: pointer;
            transition: color 0.3s ease;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-modal:hover {
            color: #f44336;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
        }
        
        .modal-body {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .bank-editor {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .bank-name-input {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 16px;
        }
        
        .bank-name-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .bank-description {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 14px;
            min-height: 60px;
            resize: vertical;
        }
        
        .bank-description:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .bank-info-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .info-input {
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }
        
        .info-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 300px;
        }
        
        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            color: #ccc;
            font-size: 14px;
        }
        
        .editor-header span {
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 10px;
            border-radius: 5px;
        }
        
        .bank-editor textarea {
            flex: 1;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: none;
        }
        
        .bank-editor textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .editor-info {
            color: #ccc;
            font-size: 12px;
            margin-top: 10px;
            text-align: right;
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 20px;
        }
        
        /* æ§åˆ¶é¢æ¿æ ·å¼ */
        .control-panel {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-open {
            background: linear-gradient(135deg, #2196F3 0%, #0D47A1 100%);
            color: white;
        }
        
        .btn-open:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(33, 150, 243, 0.3);
        }
        
        .btn-start {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
        }
        
        .btn-start:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.3);
        }
        
        .btn-stop {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            color: white;
        }
        
        .btn-stop:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(244, 67, 54, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* çŠ¶æ€é¢æ¿æ ·å¼ */
        .status-panel {
            margin-top: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .status-header h3 {
            color: #8a8aff;
            font-size: 18px;
        }
        
        .status-content {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .log {
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .log.info { color: #2196F3; }
        .log.success { color: #4CAF50; }
        .log.warning { color: #FF9800; }
        .log.error { color: #f44336; }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 12px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 1024px) {
            .config-panel {
                grid-template-columns: 1fr;
            }
            
            .bank-info-row {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .speed-options {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .control-panel {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 28px;
            }
            
            .bank-buttons {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .bank-btn {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }
            
            .bank-items {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>é—®å·æ˜Ÿè‡ªåŠ¨ç­”é¢˜å™¨</h1>
            <div class="subtitle">V7.0.1 æ™ºèƒ½è¯†åˆ« | é¢˜åº“ç®¡ç†ç‰ˆ</div>
            <div class="version">Design By MCXGJKH</div>
        </div>
        
        <div class="config-panel">
            <div class="config-section">
                <h2><i>ğŸ”—</i> é—®å·é…ç½®</h2>
                
                <div class="url-input">
                    <div class="url-prefix">
                        <span class="prefix">https://ks.wjx.com/vm/</span>
                        <span>é—®å·é“¾æ¥åç¼€</span>
                    </div>
                    <div class="url-input-field">
                        <input type="text" id="urlSuffix" placeholder="wRSroLM.aspx" value="wRSroLM.aspx">
                    </div>
                </div>
                
                <h2><i>ğŸ¯</i> æ­£ç¡®ç‡æ§åˆ¶</h2>
                <div class="accuracy-control">
                    <div class="accuracy-slider-container">
                        <input type="range" min="0" max="100" value="100" class="accuracy-slider" id="accuracySlider">
                        <div class="accuracy-ticks">
                            <span>0%</span>
                            <span>25%</span>
                            <span>50%</span>
                            <span>75%</span>
                            <span>100%</span>
                        </div>
                    </div>
                    <div class="accuracy-display">
                        <span>è®¾å®šæ­£ç¡®ç‡:</span>
                        <span class="accuracy-value" id="accuracyValue">100%</span>
                    </div>
                    <div class="accuracy-info">
                        <strong>å»ä¸€æ³•è®¡ç®—è§„åˆ™ï¼š</strong><br>
                        æ­£ç¡®é¢˜æ•° = ceil(æœ‰æ•ˆé¢˜ç›®æ•° Ã— æ­£ç¡®ç‡%)<br>
                        æœ‰æ•ˆé¢˜ç›®æ•° = æ€»é¢˜ç›®æ•° - åŸºç¡€ä¿¡æ¯å¡«å†™é¢˜æ•°<br>
                        å®é™…æ­£ç¡®ç‡ â‰¥ è®¾å®šæ­£ç¡®ç‡
                    </div>
                </div>
            </div>
            
            <div class="config-section">
                <h2><i>ğŸ“š</i> é¢˜åº“ç®¡ç†</h2>
                
                <div class="bank-manager">
                    <div class="bank-selector">
                        <select class="bank-select" id="bankSelect">
                            <!-- é¢˜åº“é€‰é¡¹ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                        </select>
                        <div class="bank-buttons">
                            <button class="bank-btn" id="addBankBtn" title="æ·»åŠ æ–°é¢˜åº“">+</button>
                            <button class="bank-btn edit" id="editBankBtn" title="ç¼–è¾‘å½“å‰é¢˜åº“">âœï¸</button>
                            <button class="bank-btn delete" id="deleteBankBtn" title="åˆ é™¤å½“å‰é¢˜åº“">-</button>
                            <button class="bank-btn info" id="bankInfoBtn" title="é¢˜åº“ä¿¡æ¯">i</button>
                        </div>
                    </div>
                    
                    <div class="bank-preview" id="bankPreview">
                        <div class="bank-header">
                            <div class="bank-stats">æ­£åœ¨åŠ è½½é¢˜åº“ä¿¡æ¯...</div>
                        </div>
                        <div class="bank-items">
                            <div class="bank-item">æ­£åœ¨åŠ è½½é¢˜ç›®é¢„è§ˆ...</div>
                        </div>
                    </div>
                </div>
                
                <h2 style="margin-top: 30px;"><i>âš¡</i> é€Ÿåº¦é€‰æ‹©</h2>
                <div class="speed-options" id="speedOptions">
                    <!-- é€Ÿåº¦é€‰é¡¹ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
        
        <div class="info-box" style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 25px; margin-bottom: 20px;">
            <h3 style="color: #8a8aff; margin-bottom: 15px; font-size: 20px;">ä½¿ç”¨è¯´æ˜</h3>
            <div style="color: #ccc; line-height: 1.6;">
                <ul style="padding-left: 20px; margin: 10px 0;">
                    <li>1. è¾“å…¥é—®å·é“¾æ¥åç¼€ (å¦‚: wRSroLM.aspx)</li>
                    <li>2. é€‰æ‹©æˆ–åˆ›å»ºé¢˜åº“ (æ”¯æŒæœ€å¤š1000æ¡é¢˜ç›®ï¼Œæ¯100è¡Œè‡ªåŠ¨æ‰©å±•)</li>
                    <li>3. è®¾ç½®æ­£ç¡®ç‡ (0-100%ï¼Œé‡‡ç”¨å»ä¸€æ³•ä¿è¯å®é™…æ­£ç¡®ç‡â‰¥è®¾å®šå€¼)</li>
                    <li>4. é€‰æ‹©ç­”é¢˜é€Ÿåº¦</li>
                    <li>5. ç‚¹å‡»"æ‰“å¼€é—®å·é¡µé¢"æŒ‰é’®</li>
                    <li>6. ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨å¼€å§‹ç­”é¢˜</li>
                    <li>7. ç­”é¢˜å®Œæˆåä¼šå¼¹å‡ºç¡®è®¤æäº¤å¯¹è¯æ¡†</li>
                </ul>
                <p><strong>æ³¨æ„ï¼š</strong>æœ¬ç¨‹åºä»…ç”¨äºå­¦ä¹ ç ”ç©¶ï¼Œè¯·å‹¿ç”¨äºéæ³•ç”¨é€”</p>
            </div>
        </div>
        
        <div class="control-panel">
            <button class="btn btn-open" id="btnOpen">
                æ‰“å¼€é—®å·é¡µé¢
            </button>
            <button class="btn btn-start" id="btnStart" disabled>
                <span class="loading" style="display: none;"></span>
                å¼€å§‹è‡ªåŠ¨ç­”é¢˜
            </button>
        </div>
        
        <div class="status-panel">
            <div class="status-header">
                <h3>çŠ¶æ€ä¿¡æ¯</h3>
                <button onclick="clearLogs()" style="background:none;border:1px solid #666;color:#666;padding:5px 10px;border-radius:5px;font-size:12px;cursor:pointer;">
                    æ¸…ç©ºæ—¥å¿—
                </button>
            </div>
            <div class="status-content" id="statusContent">
                <div class="log info">ç¨‹åºå·²å¯åŠ¨ï¼Œç­‰å¾…æ“ä½œ...</div>
            </div>
        </div>
        
        <div class="footer">
            Â© 2026 MCXGJKH | é—®å·æ˜Ÿè‡ªåŠ¨ç­”é¢˜å™¨ V7.0.1 - é¢˜åº“ç®¡ç†ç‰ˆ
        </div>
    </div>

    <!-- é¢˜åº“ç¼–è¾‘å™¨æ¨¡æ€æ¡† -->
    <div class="modal" id="bankEditorModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">ç¼–è¾‘é¢˜åº“</h3>
                <button class="close-modal" id="closeModalBtn">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="bank-editor">
                    <input type="text" class="bank-name-input" id="bankNameInput" placeholder="é¢˜åº“åç§°" value="æ–°é¢˜åº“">
                    <textarea class="bank-description" id="bankDescription" placeholder="é¢˜åº“æè¿° (å¯é€‰)"></textarea>
                    
                    <div class="bank-info-row">
                        <input type="number" class="info-input" id="basicInfoCount" placeholder="åŸºç¡€ä¿¡æ¯å¡«å†™é¢˜æ•°" value="2" min="0" max="20">
                        <input type="number" class="info-input" id="startQuestionNum" placeholder="èµ·å§‹é¢˜ç›®ç¼–å·" value="3" min="1" max="1000">
                    </div>
                    
                    <div class="editor-container">
                        <div class="editor-header">
                            <span>é¢˜ç›®ç­”æ¡ˆ (æ¯è¡Œä¸€ä¸ªç­”æ¡ˆï¼Œç¨‹åºä¼šè‡ªåŠ¨æ ¼å¼åŒ–ä¸ºæ•°ç»„)</span>
                            <span id="currentLineCount">0 è¡Œ</span>
                        </div>
                        <textarea id="bankContentTextarea" placeholder="è¯·è¾“å…¥é¢˜ç›®ç­”æ¡ˆï¼Œæ¯è¡Œä¸€ä¸ªç­”æ¡ˆï¼š
ä¾‹å¦‚ï¼š
æçº¯åæ‰€å¾—ç²¾ç›æœªå®Œå…¨å¹²ç‡¥
è’¸å‘çš¿
æœ‰æ°”æ³¡äº§ç”Ÿ

ç¨‹åºä¼šè‡ªåŠ¨å°†ç­”æ¡ˆæ ¼å¼åŒ–ä¸ºï¼š['ç­”æ¡ˆ1', 'ç­”æ¡ˆ2', 'ç­”æ¡ˆ3']
å¹¶è‡ªåŠ¨æ·»åŠ å¸¸è§çš„å­—æ¯é€‰é¡¹æ ¼å¼å¦‚ï¼š['ç­”æ¡ˆ1', 'A ç­”æ¡ˆ1']

ç³»ç»Ÿæ”¯æŒæœ€å¤š1000è¡Œï¼Œæ¯100è¡Œè‡ªåŠ¨æ‰©å±•æ–‡æœ¬æ¡†"></textarea>
                    </div>
                    
                    <div class="editor-info">
                        <span id="maxLinesInfo">æœ€å¤§æ”¯æŒ: 100 è¡Œ</span>
                        <span> | </span>
                        <span>å·²ä½¿ç”¨: <span id="usedLines">0</span> è¡Œ</span>
                        <span> | </span>
                        <span>å‰©ä½™: <span id="remainingLines">100</span> è¡Œ</span>
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-open" id="cancelEditBtn" style="flex: none; padding: 12px 25px;">
                    å–æ¶ˆ
                </button>
                <button class="btn btn-start" id="saveBankBtn" style="flex: none; padding: 12px 25px;">
                    ä¿å­˜é¢˜åº“
                </button>
            </div>
        </div>
    </div>

    <!-- é¢˜åº“ä¿¡æ¯æ¨¡æ€æ¡† -->
    <div class="modal" id="bankInfoModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 id="infoModalTitle">é¢˜åº“ä¿¡æ¯</h3>
                <button class="close-modal" id="closeInfoModalBtn">&times;</button>
            </div>
            
            <div class="modal-body">
                <div id="bankInfoContent" style="color: #ccc; line-height: 1.6;">
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #8a8aff; margin-bottom: 10px;" id="infoBankName">é¢˜åº“åç§°</h4>
                        <p id="infoBankDescription">æš‚æ— æè¿°</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;">
                            <div style="color: #8a8aff; font-size: 12px;">æ€»é¢˜ç›®æ•°</div>
                            <div style="font-size: 24px; font-weight: bold;" id="infoTotalQuestions">0</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;">
                            <div style="color: #8a8aff; font-size: 12px;">æœ‰æ•ˆé¢˜ç›®æ•°</div>
                            <div style="font-size: 24px; font-weight: bold;" id="infoValidQuestions">0</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;">
                            <div style="color: #8a8aff; font-size: 12px;">åŸºç¡€ä¿¡æ¯é¢˜æ•°</div>
                            <div style="font-size: 24px; font-weight: bold;" id="infoBasicQuestions">0</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;">
                            <div style="color: #8a8aff; font-size: 12px;">èµ·å§‹ç¼–å·</div>
                            <div style="font-size: 24px; font-weight: bold;" id="infoStartNumber">3</div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <h4 style="color: #8a8aff; margin-bottom: 10px;">æ­£ç¡®ç‡è®¡ç®—è¯´æ˜</h4>
                        <p>æœ‰æ•ˆé¢˜ç›®æ•° = æ€»é¢˜ç›®æ•° - åŸºç¡€ä¿¡æ¯å¡«å†™é¢˜æ•°</p>
                        <p>éœ€è¦æ­£ç¡®çš„é¢˜ç›®æ•° = ceil(æœ‰æ•ˆé¢˜ç›®æ•° Ã— æ­£ç¡®ç‡%)</p>
                        <p>å®é™…æ­£ç¡®ç‡ â‰¥ è®¾å®šæ­£ç¡®ç‡ (å»ä¸€æ³•ä¿è¯)</p>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;">
                        <h4 style="color: #8a8aff; margin-bottom: 10px;">ç¤ºä¾‹è®¡ç®—</h4>
                        <p id="infoCalculationExample">ç¤ºä¾‹ï¼šæ€»é¢˜ç›®42é¢˜ï¼ŒåŸºç¡€ä¿¡æ¯2é¢˜ï¼Œæœ‰æ•ˆé¢˜ç›®40é¢˜</p>
                        <p id="infoAccuracyExample">è®¾å®š90%æ­£ç¡®ç‡æ—¶ï¼Œéœ€è¦æ­£ç¡® ceil(40 Ã— 90%) = 36 é¢˜</p>
                        <p>å®é™…æ­£ç¡®ç‡ = 36/40 = 90% (æ­£å¥½æ»¡è¶³)</p>
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-open" id="closeInfoBtn" style="flex: none; padding: 12px 25px;">
                    å…³é—­
                </button>
            </div>
        </div>
    </div>

    <script>
        // é€Ÿåº¦é…ç½®ï¼ˆä¸answer-script.jsä¿æŒä¸€è‡´ï¼‰
        const SPEED_OPTIONS = [
            { name: 'åˆ˜å­è½©é€Ÿåº¦', value: 'lightning', delay: 100, desc: '5ç§’å®Œæˆæ‰€æœ‰é¢˜ç›®' },
            { name: 'æé€Ÿ', value: 'turbo', delay: 200, desc: '10ç§’å®Œæˆæ‰€æœ‰é¢˜ç›®' },
            { name: 'å¿«é€Ÿ', value: 'fast', delay: 300, desc: '15ç§’å®Œæˆæ‰€æœ‰é¢˜ç›®' },
            { name: 'æ ‡å‡†', value: 'normal', delay: 500, desc: '25ç§’å®Œæˆæ‰€æœ‰é¢˜ç›®' },
            { name: 'é€‚ä¸­', value: 'medium', delay: 800, desc: '40ç§’å®Œæˆæ‰€æœ‰é¢˜ç›®' },
            { name: 'è‡ªç„¶', value: 'natural', delay: 1200, desc: '1åˆ†é’Ÿå®Œæˆæ‰€æœ‰é¢˜ç›®' },
            { name: 'æ…¢é€Ÿ', value: 'slow', delay: 1800, desc: '1åˆ†30ç§’å®Œæˆæ‰€æœ‰é¢˜ç›®' },
            { name: 'ææ…¢', value: 'very-slow', delay: 2500, desc: '2åˆ†é’Ÿå®Œæˆæ‰€æœ‰é¢˜ç›®' },
            { name: 'éšæœº', value: 'random', delay: 'random', desc: 'éšæœºé€Ÿåº¦æ¨¡æ‹ŸçœŸäºº' }
        ];
        
        // é»˜è®¤å†…ç½®é¢˜åº“ï¼ˆåŸV5.0ç‰ˆé¢˜åº“ï¼‰
        const DEFAULT_QUESTION_BANK = {
            name: "2026ç†åŒ–ç”Ÿå®éªŒæ“ä½œæ¨¡æ‹Ÿè€ƒè¯•-åŒ–å­¦",
            description: "æ±¤é€Šæ¹–åˆä¸­æ¨¡æ‹Ÿ | åŸºç¡€ä¿¡æ¯å¡«å†™é¢˜ï¼š2é¢˜",
            basicInfoCount: 2,
            startQuestionNum: 3,
            answers: {
                "1": ["æœ±ä¸€é¾™"],
                "2": ["901"],
                "3": ["é”å™¨", "D é”å™¨"],
                "4": ["è’¸å‘çš¿", "D è’¸å‘çš¿"],
                "5": ["å®Œå…¨æ³¨æ»¡ç»ç’ƒç®¡", "B å®Œå…¨æ³¨æ»¡ç»ç’ƒç®¡"],
                "6": ["æœ‰æ°”æ³¡äº§ç”Ÿ", "C æœ‰æ°”æ³¡äº§ç”Ÿ"],
                "7": ["ä¸ç”µæºè´Ÿæç›¸è¿çš„ç»ç’ƒç®¡å†…äº§ç”Ÿæ±½æ³¡çš„é€Ÿç‡æ›´å¿«"],
                "8": ["cä¸­æ¶²é¢æœ€é«˜", "C cä¸­æ¶²é¢æœ€é«˜"],
                "9": ["çƒ§æ¯å†…å£æœ‰æ°´é›¾", "A çƒ§æ¯å†…å£æœ‰æ°´é›¾"],
                "10": ["1:2", "B 1:2"],
                "11": ["æœ¨æ¡ç‡ƒçƒ§å¾—æ›´æ—º", "D æœ¨æ¡ç‡ƒçƒ§å¾—æ›´æ—º"],
                "12": ["ç”µè§£å™¨ä¸­åŠ å…¥çš„æ˜¯è’¸é¦æ°´", "A ç”µè§£å™¨ä¸­åŠ å…¥çš„æ˜¯è’¸é¦æ°´"],
                "13": ["é›†æ°”ç“¶", "D é›†æ°”ç“¶"],
                "14": ["é•Šå­", "C é•Šå­"],
                "15": ["å¯¼ç®¡å£æœ‰æ°”æ³¡å†’å‡º", "A å¯¼ç®¡å£æœ‰æ°”æ³¡å†’å‡º"],
                "16": ["çŸ³ç°çŸ³å’Œç¨€ç›é…¸", "C çŸ³ç°çŸ³å’Œç¨€ç›é…¸"],
                "17": ["å°†ç‡ƒç€çš„æœ¨æ¡æ”¾åœ¨é›†æ°”ç“¶å£", "B å°†ç‡ƒç€çš„æœ¨æ¡æ”¾åœ¨é›†æ°”ç“¶å£"],
                "18": ["äºŒæ°§åŒ–ç¢³èƒ½å‚ä¸å…‰åˆä½œç”¨", "D äºŒæ°§åŒ–ç¢³èƒ½å‚ä¸å…‰åˆä½œç”¨"],
                "19": ["äºŒæ°§åŒ–ç¢³èƒ½æº¶äºæ°´", "B äºŒæ°§åŒ–ç¢³èƒ½æº¶äºæ°´"],
                "20": ["â‘ â‘¢", "A â‘ â‘¢"],
                "21": ["å›¾IIIä¸­çº¸èŠ±å˜çº¢", "C å›¾IIIä¸­çº¸èŠ±å˜çº¢"],
                "22": ["äºŒæ°§åŒ–ç¢³èƒ½ä½¿æ¾„æ¸…çŸ³ç°æ°´å˜æµ‘æµŠ", "C äºŒæ°§åŒ–ç¢³èƒ½ä½¿æ¾„æ¸…çŸ³ç°æ°´å˜æµ‘æµŠ"],
                "23": ["C"],
                "24": ["å»¶å±•æ€§", "C å»¶å±•æ€§"],
                "25": ["å¯¼ç”µæ€§", "B å¯¼ç”µæ€§"],
                "26": ["ç¡¬é“çš„ç¡¬åº¦æ›´å¤§", "D ç¡¬é“çš„ç¡¬åº¦æ›´å¤§"],
                "27": ["æ°¢æ°”", "C æ°¢æ°”"],
                "28": ["é“", "A é“"],
                "29": ["é“œä¸æ°§æ°”ååº”ç”Ÿæˆæ°§åŒ–é“œ", "B é“œä¸æ°§æ°”ååº”ç”Ÿæˆæ°§åŒ–é“œ"],
                "30": ["è¯¥å®éªŒè¯´æ˜é‡‘å±æ´»åŠ¨æ€§ï¼šé“¶ ï¼ é“œ", "D è¯¥å®éªŒè¯´æ˜é‡‘å±æ´»åŠ¨æ€§ï¼šé“¶ ï¼ é“œ"],
                "31": ["é“œ ï¼ é“¶", "A é“œ ï¼ é“¶"],
                "32": ["å®éªŒä¸­æº¶æ¶²ç”±è“è‰²å˜æˆæµ…ç»¿è‰²", "A å®éªŒä¸­æº¶æ¶²ç”±è“è‰²å˜æˆæµ…ç»¿è‰²"],
                "33": ["çƒ§æ¯", "B çƒ§æ¯"],
                "34": ["æ‰˜ç›˜å¤©å¹³", "C æ‰˜ç›˜å¤©å¹³"],
                "35": ["æ…æ‹Œï¼ŒåŠ å¿«ç²—ç›æº¶è§£", "B æ…æ‹Œï¼ŒåŠ å¿«ç²—ç›æº¶è§£"],
                "36": ["å¹³è§†å‡¹æ¶²é¢çš„æœ€ä½å¤„", "C å¹³è§†å‡¹æ¶²é¢çš„æœ€ä½å¤„"],
                "37": ["å¼•æµ", "C å¼•æµ"],
                "38": ["é‡ç­’", "B é‡ç­’"],
                "39": ["å®éªŒä¸­æ»¤çº¸å‘ç”Ÿç ´æŸ", "D å®éªŒä¸­æ»¤çº¸å‘ç”Ÿç ´æŸ"],
                "40": ["å½“è’¸å‘çš¿ä¸­å‡ºç°è¾ƒå¤šå›ºä½“æ—¶åœæ­¢åŠ çƒ­", "B å½“è’¸å‘çš¿ä¸­å‡ºç°è¾ƒå¤šå›ºä½“æ—¶åœæ­¢åŠ çƒ­"],
                "41": ["é£Ÿç›å’Œç»†æ²™", "A é£Ÿç›å’Œç»†æ²™"],
                "42": ["æçº¯åæ‰€å¾—ç²¾ç›æœªå®Œå…¨å¹²ç‡¥", "D æçº¯åæ‰€å¾—ç²¾ç›æœªå®Œå…¨å¹²ç‡¥"]
            }
        };
        
        // é¢˜åº“æ•°æ®å­˜å‚¨ç»“æ„
        let questionBanks = {};
        let selectedSpeed = null;
        let selectedBank = DEFAULT_QUESTION_BANK.name;
        let wjxWindowId = null;
        let accuracy = 100; // æ­£ç¡®ç‡ç™¾åˆ†æ¯”
        let isEditingBank = false;
        let editingBankName = "";
        let maxLines = 100; // åˆå§‹æœ€å¤§è¡Œæ•°
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            renderSpeedOptions();
            setupEventListeners();
            loadBanksFromStorage();
            updateBankSelect();
            updateBankPreview();
            log('ç¨‹åºåˆå§‹åŒ–å®Œæˆ V7.0.1', 'success');
        });
        
        // æ¸²æŸ“é€Ÿåº¦é€‰é¡¹
        function renderSpeedOptions() {
            const container = document.getElementById('speedOptions');
            container.innerHTML = '';
            
            SPEED_OPTIONS.forEach(option => {
                const div = document.createElement('div');
                div.className = 'speed-option';
                div.innerHTML = `
                    <div class="speed-name">${option.name}</div>
                    <div class="speed-desc">${option.desc}</div>
                `;
                
                div.addEventListener('click', () => {
                    // ç§»é™¤å…¶ä»–é€‰ä¸­
                    document.querySelectorAll('.speed-option').forEach(el => {
                        el.classList.remove('selected');
                    });
                    
                    // é€‰ä¸­å½“å‰
                    div.classList.add('selected');
                    selectedSpeed = option;
                    
                    log(`å·²é€‰æ‹©é€Ÿåº¦: ${option.name}`, 'success');
                });
                
                container.appendChild(div);
            });
            
            // é»˜è®¤é€‰ä¸­æ ‡å‡†é€Ÿåº¦
            setTimeout(() => {
                container.children[3].click();
            }, 100);
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // æ­£ç¡®ç‡æ»‘å—
            const accuracySlider = document.getElementById('accuracySlider');
            const accuracyValue = document.getElementById('accuracyValue');
            
            accuracySlider.addEventListener('input', () => {
                accuracy = parseInt(accuracySlider.value);
                accuracyValue.textContent = `${accuracy}%`;
                updateAccuracyExamples();
            });
            
            // é—®å·é“¾æ¥è¾“å…¥
            const urlSuffixInput = document.getElementById('urlSuffix');
            urlSuffixInput.addEventListener('input', () => {
                // éªŒè¯è¾“å…¥æ ¼å¼
                const value = urlSuffixInput.value.trim();
                if (value && !value.match(/^[a-zA-Z0-9_\-\.]+$/)) {
                    log('è­¦å‘Š: é“¾æ¥åç¼€åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€è¿å­—ç¬¦å’Œç‚¹å·', 'warning');
                }
            });
            
            // é¢˜åº“é€‰æ‹©
            const bankSelect = document.getElementById('bankSelect');
            bankSelect.addEventListener('change', () => {
                selectedBank = bankSelect.value;
                updateBankPreview();
                log(`å·²é€‰æ‹©é¢˜åº“: ${selectedBank}`, 'success');
            });
            
            // æ·»åŠ é¢˜åº“æŒ‰é’®
            document.getElementById('addBankBtn').addEventListener('click', () => {
                isEditingBank = false;
                editingBankName = "";
                document.getElementById('modalTitle').textContent = 'æ–°å»ºé¢˜åº“';
                document.getElementById('bankNameInput').value = 'æ–°é¢˜åº“';
                document.getElementById('bankDescription').value = '';
                document.getElementById('basicInfoCount').value = '2';
                document.getElementById('startQuestionNum').value = '3';
                document.getElementById('bankContentTextarea').value = '';
                updateLineCount();
                document.getElementById('bankEditorModal').style.display = 'flex';
            });
            
            // ç¼–è¾‘é¢˜åº“æŒ‰é’®
            document.getElementById('editBankBtn').addEventListener('click', () => {
                if (!questionBanks[selectedBank]) {
                    log('é”™è¯¯: æœªæ‰¾åˆ°å½“å‰é¢˜åº“æ•°æ®', 'error');
                    return;
                }
                
                isEditingBank = true;
                editingBankName = selectedBank;
                const bank = questionBanks[selectedBank];
                
                document.getElementById('modalTitle').textContent = 'ç¼–è¾‘é¢˜åº“';
                document.getElementById('bankNameInput').value = bank.name || selectedBank;
                document.getElementById('bankDescription').value = bank.description || '';
                document.getElementById('basicInfoCount').value = bank.basicInfoCount || 2;
                document.getElementById('startQuestionNum').value = bank.startQuestionNum || 3;
                
                // å°†é¢˜åº“ç­”æ¡ˆè½¬æ¢ä¸ºæ–‡æœ¬æ ¼å¼
                let text = '';
                const answers = bank.answers || {};
                
                // è·å–é¢˜ç›®ç¼–å·å¹¶æ’åº
                const questionNumbers = Object.keys(answers)
                    .filter(key => key.match(/^\d+$/))
                    .map(Number)
                    .sort((a, b) => a - b);
                
                // ä»èµ·å§‹é¢˜ç›®ç¼–å·å¼€å§‹è¾“å‡º
                const startNum = bank.startQuestionNum || 3;
                for (let i = startNum; i <= Math.max(...questionNumbers); i++) {
                    if (answers[i] && answers[i].length > 0) {
                        text += answers[i][0] + '\n';
                    }
                }
                
                document.getElementById('bankContentTextarea').value = text.trim();
                updateLineCount();
                document.getElementById('bankEditorModal').style.display = 'flex';
            });
            
            // åˆ é™¤é¢˜åº“æŒ‰é’®
            document.getElementById('deleteBankBtn').addEventListener('click', () => {
                if (selectedBank === DEFAULT_QUESTION_BANK.name) {
                    log('é»˜è®¤é¢˜åº“ä¸èƒ½åˆ é™¤', 'error');
                    return;
                }
                
                if (Object.keys(questionBanks).length <= 1) {
                    log('ä¸èƒ½åˆ é™¤æœ€åä¸€ä¸ªè‡ªå®šä¹‰é¢˜åº“', 'error');
                    return;
                }
                
                if (confirm(`ç¡®å®šè¦åˆ é™¤é¢˜åº“ "${selectedBank}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`)) {
                    delete questionBanks[selectedBank];
                    saveBanksToStorage();
                    updateBankSelect();
                    
                    // é€‰æ‹©å¦ä¸€ä¸ªé¢˜åº“
                    selectedBank = Object.keys(questionBanks)[0];
                    bankSelect.value = selectedBank;
                    updateBankPreview();
                    
                    log(`å·²åˆ é™¤é¢˜åº“: ${selectedBank}`, 'success');
                }
            });
            
            // é¢˜åº“ä¿¡æ¯æŒ‰é’®
            document.getElementById('bankInfoBtn').addEventListener('click', () => {
                if (!questionBanks[selectedBank]) {
                    log('é”™è¯¯: æœªæ‰¾åˆ°å½“å‰é¢˜åº“æ•°æ®', 'error');
                    return;
                }
                
                const bank = questionBanks[selectedBank];
                const answers = bank.answers || {};
                const totalQuestions = Object.keys(answers).length;
                const basicInfoCount = bank.basicInfoCount || 2;
                const validQuestions = Math.max(0, totalQuestions - basicInfoCount);
                
                // æ›´æ–°ä¿¡æ¯å†…å®¹
                document.getElementById('infoModalTitle').textContent = 'é¢˜åº“ä¿¡æ¯';
                document.getElementById('infoBankName').textContent = bank.name || selectedBank;
                document.getElementById('infoBankDescription').textContent = bank.description || 'æš‚æ— æè¿°';
                document.getElementById('infoTotalQuestions').textContent = totalQuestions;
                document.getElementById('infoBasicQuestions').textContent = basicInfoCount;
                document.getElementById('infoValidQuestions').textContent = validQuestions;
                document.getElementById('infoStartNumber').textContent = bank.startQuestionNum || 3;
                
                // æ›´æ–°è®¡ç®—ç¤ºä¾‹
                document.getElementById('infoCalculationExample').textContent = 
                    `ç¤ºä¾‹ï¼šæ€»é¢˜ç›®${totalQuestions}é¢˜ï¼ŒåŸºç¡€ä¿¡æ¯${basicInfoCount}é¢˜ï¼Œæœ‰æ•ˆé¢˜ç›®${validQuestions}é¢˜`;
                
                if (validQuestions > 0) {
                    const neededCorrect = Math.ceil(validQuestions * accuracy / 100);
                    document.getElementById('infoAccuracyExample').textContent = 
                        `è®¾å®š${accuracy}%æ­£ç¡®ç‡æ—¶ï¼Œéœ€è¦æ­£ç¡® ceil(${validQuestions} Ã— ${accuracy}%) = ${neededCorrect} é¢˜`;
                } else {
                    document.getElementById('infoAccuracyExample').textContent = 
                        'æœ‰æ•ˆé¢˜ç›®æ•°ä¸º0ï¼Œæ— æ³•è®¡ç®—æ­£ç¡®ç‡';
                }
                
                document.getElementById('bankInfoModal').style.display = 'flex';
            });
            
            // é¢˜åº“ç¼–è¾‘å™¨ç›¸å…³
            document.getElementById('closeModalBtn').addEventListener('click', closeBankEditor);
            document.getElementById('cancelEditBtn').addEventListener('click', closeBankEditor);
            document.getElementById('saveBankBtn').addEventListener('click', saveBank);
            
            // é¢˜åº“ä¿¡æ¯æ¨¡æ€æ¡†ç›¸å…³
            document.getElementById('closeInfoModalBtn').addEventListener('click', closeBankInfo);
            document.getElementById('closeInfoBtn').addEventListener('click', closeBankInfo);
            
            // é¢˜åº“å†…å®¹æ–‡æœ¬åŒºåŸŸ
            const textarea = document.getElementById('bankContentTextarea');
            textarea.addEventListener('input', function() {
                updateLineCount();
                autoExpandTextarea(this);
            });
            
            // åŸºç¡€ä¿¡æ¯é¢˜æ•°è¾“å…¥éªŒè¯
            document.getElementById('basicInfoCount').addEventListener('input', function() {
                const value = parseInt(this.value) || 0;
                if (value < 0) this.value = 0;
                if (value > 20) this.value = 20;
            });
            
            // èµ·å§‹é¢˜ç›®ç¼–å·è¾“å…¥éªŒè¯
            document.getElementById('startQuestionNum').addEventListener('input', function() {
                const value = parseInt(this.value) || 1;
                if (value < 1) this.value = 1;
                if (value > 1000) this.value = 1000;
            });
            
            // æ‰“å¼€é—®å·é¡µé¢æŒ‰é’®
            document.getElementById('btnOpen').addEventListener('click', openWjxPage);
            
            // å¼€å§‹ç­”é¢˜æŒ‰é’®
            document.getElementById('btnStart').addEventListener('click', startAutoAnswer);
            
            // ç›‘å¬æ¥è‡ªElectronçš„äº‹ä»¶
            if (window.electronAPI) {
                window.electronAPI.onWjxLoaded((event, success, error) => {
                    if (success) {
                        log('é—®å·é¡µé¢åŠ è½½å®Œæˆï¼Œè„šæœ¬æ³¨å…¥æˆåŠŸ', 'success');
                        document.getElementById('btnStart').disabled = false;
                        
                        // æ¢å¤æŒ‰é’®çŠ¶æ€
                        const btn = document.getElementById('btnStart');
                        const loading = btn.querySelector('.loading');
                        btn.disabled = false;
                        loading.style.display = 'none';
                        btn.innerHTML = 'å¼€å§‹è‡ªåŠ¨ç­”é¢˜';
                        
                    } else {
                        log(`è„šæœ¬æ³¨å…¥å¤±è´¥: ${error}`, 'error');
                    }
                });
                
                window.electronAPI.onWjxClosed(() => {
                    log('é—®å·çª—å£å·²å…³é—­', 'warning');
                    wjxWindowId = null;
                    document.getElementById('btnStart').disabled = true;
                });
                
                window.electronAPI.onWjxError((error) => {
                    log(`é¡µé¢åŠ è½½é”™è¯¯: ${error}`, 'error');
                });
            }
        }
        
        // åŠ è½½é¢˜åº“æ•°æ®
        function loadBanksFromStorage() {
            try {
                // å°è¯•ä»localStorageåŠ è½½é¢˜åº“
                const savedBanks = localStorage.getItem('questionBanksV7');
                if (savedBanks) {
                    questionBanks = JSON.parse(savedBanks);
                    log('ä»æœ¬åœ°å­˜å‚¨åŠ è½½é¢˜åº“æˆåŠŸ', 'success');
                } else {
                    // åˆå§‹åŒ–é»˜è®¤é¢˜åº“
                    questionBanks[DEFAULT_QUESTION_BANK.name] = DEFAULT_QUESTION_BANK;
                    log('ä½¿ç”¨é»˜è®¤é¢˜åº“', 'info');
                }
            } catch (e) {
                log('åŠ è½½é¢˜åº“å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é¢˜åº“: ' + e.message, 'error');
                questionBanks[DEFAULT_QUESTION_BANK.name] = DEFAULT_QUESTION_BANK;
            }
        }
        
        // ä¿å­˜é¢˜åº“æ•°æ®
        function saveBanksToStorage() {
            try {
                localStorage.setItem('questionBanksV7', JSON.stringify(questionBanks));
                return true;
            } catch (e) {
                log('ä¿å­˜é¢˜åº“åˆ°æœ¬åœ°å­˜å‚¨å¤±è´¥: ' + e.message, 'error');
                return false;
            }
        }
        
        // æ›´æ–°é¢˜åº“é€‰æ‹©ä¸‹æ‹‰æ¡†
        function updateBankSelect() {
            const bankSelect = document.getElementById('bankSelect');
            bankSelect.innerHTML = '';
            
            Object.keys(questionBanks).forEach(bankName => {
                const option = document.createElement('option');
                option.value = bankName;
                option.textContent = bankName;
                if (bankName === DEFAULT_QUESTION_BANK.name) {
                    option.textContent += ' (é»˜è®¤)';
                }
                bankSelect.appendChild(option);
            });
            
            bankSelect.value = selectedBank;
        }
        
        // æ›´æ–°é¢˜åº“é¢„è§ˆ
        function updateBankPreview() {
            const bankPreview = document.getElementById('bankPreview');
            const bank = questionBanks[selectedBank];
            
            if (!bank) {
                bankPreview.innerHTML = `
                    <div class="bank-header">
                        <div class="bank-stats">é¢˜åº“æ•°æ®é”™è¯¯</div>
                    </div>
                    <div class="bank-items">
                        <div class="bank-item">æ— æ³•åŠ è½½é¢˜åº“ä¿¡æ¯</div>
                    </div>
                `;
                return;
            }
            
            const answers = bank.answers || {};
            const totalQuestions = Object.keys(answers).length;
            const basicInfoCount = bank.basicInfoCount || 2;
            const validQuestions = Math.max(0, totalQuestions - basicInfoCount);
            const startQuestionNum = bank.startQuestionNum || 3;
            
            // æ›´æ–°é¢„è§ˆæ ‡é¢˜
            const previewTitle = bankPreview.querySelector('.bank-header');
            if (previewTitle) {
                previewTitle.innerHTML = `
                    <div class="bank-stats">
                        é¢˜ç›®: ${totalQuestions}é¢˜ | æœ‰æ•ˆ: ${validQuestions}é¢˜ | åŸºç¡€ä¿¡æ¯: ${basicInfoCount}é¢˜
                    </div>
                `;
            }
            
            // è·å–é¢˜ç›®é¢„è§ˆï¼ˆå‰10æ¡ï¼‰
            const bankItems = bankPreview.querySelector('.bank-items');
            if (bankItems) {
                let previewHTML = '';
                const questionNumbers = Object.keys(answers)
                    .filter(key => key.match(/^\d+$/))
                    .map(Number)
                    .sort((a, b) => a - b);
                
                // æ˜¾ç¤ºåŸºç¡€ä¿¡æ¯é¢˜
                for (let i = 1; i <= Math.min(basicInfoCount, 2); i++) {
                    if (answers[i]) {
                        previewHTML += `<div class="bank-item">ç¬¬${i}é¢˜ (åŸºç¡€ä¿¡æ¯): ${answers[i][0] || ''}</div>`;
                    }
                }
                
                // æ˜¾ç¤ºå‰8æ¡æœ‰æ•ˆé¢˜ç›®
                let count = 0;
                for (let i = startQuestionNum; i <= Math.max(...questionNumbers) && count < 8; i++) {
                    if (answers[i] && answers[i].length > 0) {
                        previewHTML += `<div class="bank-item">ç¬¬${i}é¢˜: ${answers[i][0] || ''}</div>`;
                        count++;
                    }
                }
                
                // å¦‚æœæœ‰æ›´å¤šé¢˜ç›®ï¼Œæ˜¾ç¤ºæç¤º
                if (validQuestions > 8) {
                    previewHTML += `<div class="bank-item" style="border-left-color: #FF9800; font-style: italic;">
                        è¿˜æœ‰ ${validQuestions - 8} é¢˜æœªæ˜¾ç¤º...
                    </div>`;
                }
                
                // å¦‚æœæ²¡æœ‰é¢˜ç›®
                if (validQuestions === 0) {
                    previewHTML = `<div class="bank-item" style="border-left-color: #f44336;">
                        é¢˜åº“ä¸­æ²¡æœ‰æœ‰æ•ˆé¢˜ç›®ï¼Œè¯·ç¼–è¾‘é¢˜åº“æ·»åŠ ç­”æ¡ˆ
                    </div>`;
                }
                
                bankItems.innerHTML = previewHTML;
            }
            
            // æ›´æ–°æ­£ç¡®ç‡è®¡ç®—ç¤ºä¾‹
            updateAccuracyExamples();
        }
        
        // æ›´æ–°æ­£ç¡®ç‡è®¡ç®—ç¤ºä¾‹
        function updateAccuracyExamples() {
            const bank = questionBanks[selectedBank];
            if (!bank) return;
            
            const answers = bank.answers || {};
            const totalQuestions = Object.keys(answers).length;
            const basicInfoCount = bank.basicInfoCount || 2;
            const validQuestions = Math.max(0, totalQuestions - basicInfoCount);
            
            if (validQuestions > 0) {
                const neededCorrect = Math.ceil(validQuestions * accuracy / 100);
                const actualAccuracy = (neededCorrect / validQuestions * 100).toFixed(1);
                
                const exampleText = `è®¾å®š${accuracy}%æ­£ç¡®ç‡ï¼Œéœ€è¦æ­£ç¡® ${neededCorrect}/${validQuestions} é¢˜ï¼Œå®é™…æ­£ç¡®ç‡ ${actualAccuracy}%`;
                
                // æ›´æ–°æ­£ç¡®ç‡ä¿¡æ¯æ˜¾ç¤º
                const accuracyInfo = document.querySelector('.accuracy-info');
                if (accuracyInfo) {
                    accuracyInfo.innerHTML = `
                        <strong>å»ä¸€æ³•è®¡ç®—è§„åˆ™ï¼š</strong><br>
                        æœ‰æ•ˆé¢˜ç›®æ•° = æ€»é¢˜ç›®æ•° - åŸºç¡€ä¿¡æ¯å¡«å†™é¢˜æ•° = ${validQuestions}é¢˜<br>
                        éœ€è¦æ­£ç¡®çš„é¢˜æ•° = ceil(${validQuestions} Ã— ${accuracy}%) = ${neededCorrect}é¢˜<br>
                        å®é™…æ­£ç¡®ç‡ = ${neededCorrect}/${validQuestions} = ${actualAccuracy}% â‰¥ ${accuracy}%
                    `;
                }
            }
        }
        
        // è‡ªåŠ¨æ‰©å±•æ–‡æœ¬æ¡†
        function autoExpandTextarea(textarea) {
            const lines = textarea.value.split('\n').length;
            
            // æ¯100è¡Œæ‰©å±•ä¸€æ¬¡ï¼Œæœ€å¤š1000è¡Œ
            const newMaxLines = Math.min(1000, Math.max(100, Math.ceil(lines / 100) * 100));
            
            if (newMaxLines > maxLines) {
                maxLines = newMaxLines;
                textarea.rows = Math.min(30, Math.max(15, Math.ceil(lines * 0.8)));
                updateLineCount();
                log(`é¢˜åº“å®¹é‡å·²æ‰©å±•è‡³ ${maxLines} è¡Œ`, 'info');
            }
        }
        
        // æ›´æ–°è¡Œæ•°è®¡æ•°
        function updateLineCount() {
            const textarea = document.getElementById('bankContentTextarea');
            const lines = textarea.value.split('\n').filter(line => line.trim() !== '');
            const lineCount = lines.length;
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('currentLineCount').textContent = `${lineCount} è¡Œ`;
            document.getElementById('usedLines').textContent = lineCount;
            document.getElementById('remainingLines').textContent = maxLines - lineCount;
            document.getElementById('maxLinesInfo').textContent = `æœ€å¤§æ”¯æŒ: ${maxLines} è¡Œ`;
            
            // é¢œè‰²æç¤º
            const remaining = maxLines - lineCount;
            const remainingElement = document.getElementById('remainingLines');
            if (remaining <= 10) {
                remainingElement.style.color = '#f44336';
            } else if (remaining <= 50) {
                remainingElement.style.color = '#FF9800';
            } else {
                remainingElement.style.color = '#4CAF50';
            }
            
            // å¦‚æœæ¥è¿‘æœ€å¤§è¡Œæ•°ï¼Œæç¤ºæ‰©å±•
            if (lineCount >= maxLines - 5 && maxLines < 1000) {
                log(`æç¤ºï¼šé¢˜åº“å³å°†æ»¡ ${maxLines} è¡Œï¼Œä¿å­˜æ—¶ä¼šè‡ªåŠ¨æ‰©å±•`, 'warning');
            }
        }
        
        // å…³é—­é¢˜åº“ç¼–è¾‘å™¨
        function closeBankEditor() {
            document.getElementById('bankEditorModal').style.display = 'none';
        }
        
        // å…³é—­é¢˜åº“ä¿¡æ¯
        function closeBankInfo() {
            document.getElementById('bankInfoModal').style.display = 'none';
        }
        
        // ä¿å­˜é¢˜åº“
        function saveBank() {
            const bankName = document.getElementById('bankNameInput').value.trim();
            const description = document.getElementById('bankDescription').value.trim();
            const basicInfoCount = parseInt(document.getElementById('basicInfoCount').value) || 2;
            const startQuestionNum = parseInt(document.getElementById('startQuestionNum').value) || 3;
            const content = document.getElementById('bankContentTextarea').value.trim();
            
            if (!bankName) {
                log('é”™è¯¯: é¢˜åº“åç§°ä¸èƒ½ä¸ºç©º', 'error');
                return;
            }
            
            if (bankName === DEFAULT_QUESTION_BANK.name && !isEditingBank) {
                log('é”™è¯¯: ä¸èƒ½ä½¿ç”¨é»˜è®¤é¢˜åº“åç§°', 'error');
                return;
            }
            
            // è§£æå†…å®¹ä¸ºç­”æ¡ˆæ ¼å¼
            const lines = content.split('\n').filter(line => line.trim() !== '');
            const answers = {};
            
            // æ·»åŠ åŸºç¡€ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰
            if (basicInfoCount > 0) {
                // è¿™é‡Œå¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ åŸºç¡€ä¿¡æ¯çš„ç­”æ¡ˆ
                // ç›®å‰ç•™ç©ºï¼Œç”±ç”¨æˆ·åœ¨å®é™…ä½¿ç”¨æ—¶å¡«å†™
            }
            
            // ä»èµ·å§‹ç¼–å·å¼€å§‹æ·»åŠ ç­”æ¡ˆ
            let currentQuestionNum = startQuestionNum;
            
            lines.forEach((line, index) => {
                if (currentQuestionNum > 1000) {
                    log(`è­¦å‘Š: é¢˜ç›®æ•°é‡è¶…è¿‡1000æ¡é™åˆ¶ï¼Œç¬¬${index + 1}è¡Œä¹‹åçš„å†…å®¹å°†è¢«å¿½ç•¥`, 'warning');
                    return;
                }
                
                const answerText = line.trim();
                if (answerText) {
                    // ç”Ÿæˆç­”æ¡ˆæ•°ç»„ï¼ŒåŒ…æ‹¬åŸå§‹ç­”æ¡ˆå’Œå¯èƒ½çš„å¸¦å­—æ¯é€‰é¡¹
                    const answerArray = [answerText];
                    
                    // æ·»åŠ å¸¦å­—æ¯çš„é€‰é¡¹æ ¼å¼ï¼ˆAã€Bã€Cã€Dï¼‰
                    if (answerText.length < 50) { // é¿å…å¤ªé•¿çš„ç­”æ¡ˆ
                        // æ·»åŠ å¸¸è§å­—æ¯é€‰é¡¹
                        const letters = ['A', 'B', 'C', 'D'];
                        const letter = letters[Math.min(index, 3)];
                        answerArray.push(`${letter} ${answerText}`);
                    }
                    
                    answers[currentQuestionNum.toString()] = answerArray;
                    currentQuestionNum++;
                }
            });
            
            // åˆ›å»ºé¢˜åº“å¯¹è±¡
            const newBank = {
                name: bankName,
                description: description || '',
                basicInfoCount: basicInfoCount,
                startQuestionNum: startQuestionNum,
                answers: answers
            };
            
            // ä¿å­˜é¢˜åº“
            questionBanks[bankName] = newBank;
            
            // å¦‚æœæ­£åœ¨ç¼–è¾‘çš„æ˜¯æ—§é¢˜åº“åï¼Œä¸”é¢˜åº“åå·²æ›´æ”¹ï¼Œåˆ é™¤æ—§é¢˜åº“
            if (isEditingBank && editingBankName !== bankName && questionBanks[editingBankName]) {
                delete questionBanks[editingBankName];
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            const success = saveBanksToStorage();
            
            if (success) {
                // æ›´æ–°UI
                selectedBank = bankName;
                updateBankSelect();
                updateBankPreview();
                
                // å…³é—­ç¼–è¾‘å™¨
                closeBankEditor();
                
                const totalQuestions = Object.keys(answers).length;
                log(`é¢˜åº“ "${bankName}" ä¿å­˜æˆåŠŸï¼ŒåŒ…å« ${totalQuestions} é“é¢˜ç›®`, 'success');
            } else {
                log('ä¿å­˜é¢˜åº“å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å­˜å‚¨æƒé™', 'error');
            }
        }
        
        // æ‰“å¼€é—®å·é¡µé¢
        async function openWjxPage() {
            // éªŒè¯é…ç½®
            if (!selectedSpeed) {
                log('è¯·å…ˆé€‰æ‹©ç­”é¢˜é€Ÿåº¦', 'warning');
                return;
            }
            
            const urlSuffix = document.getElementById('urlSuffix').value.trim();
            if (!urlSuffix) {
                log('è¯·å¡«å†™é—®å·é“¾æ¥åç¼€', 'warning');
                return;
            }
            
            if (!selectedBank || !questionBanks[selectedBank]) {
                log('è¯·é€‰æ‹©æœ‰æ•ˆçš„é¢˜åº“', 'warning');
                return;
            }
            
            const bank = questionBanks[selectedBank];
            const answers = bank.answers || {};
            const totalQuestions = Object.keys(answers).length;
            const basicInfoCount = bank.basicInfoCount || 2;
            const validQuestions = Math.max(0, totalQuestions - basicInfoCount);
            
            if (validQuestions === 0) {
                log('è­¦å‘Š: é¢˜åº“ä¸­æ²¡æœ‰æœ‰æ•ˆé¢˜ç›®ï¼Œè¯·ç¼–è¾‘é¢˜åº“æ·»åŠ ç­”æ¡ˆ', 'warning');
                return;
            }
            
            // è®¡ç®—éœ€è¦æ­£ç¡®çš„é¢˜ç›®æ•°
            const neededCorrect = Math.ceil(validQuestions * accuracy / 100);
            const actualAccuracy = (neededCorrect / validQuestions * 100).toFixed(1);
            
            log(`æ­£åœ¨æ‰“å¼€é—®å·é¡µé¢ï¼Œé€Ÿåº¦: ${selectedSpeed.name}, æ­£ç¡®ç‡: ${accuracy}%, é¢˜åº“: ${selectedBank}...`, 'info');
            log(`é¢˜åº“ç»Ÿè®¡: æ€»${totalQuestions}é¢˜ï¼ŒåŸºç¡€ä¿¡æ¯${basicInfoCount}é¢˜ï¼Œæœ‰æ•ˆ${validQuestions}é¢˜ï¼Œéœ€è¦æ­£ç¡®${neededCorrect}é¢˜ï¼Œå®é™…æ­£ç¡®ç‡${actualAccuracy}%`, 'info');
            
            try {
                const config = {
                    speedConfig: selectedSpeed,
                    accuracy: accuracy,
                    urlSuffix: urlSuffix,
                    selectedBank: selectedBank,
                    answers: answers,
                    basicInfoCount: basicInfoCount
                };
                
                const result = await window.electronAPI.openWjxWindow(config);
                if (result.success) {
                    wjxWindowId = result.windowId;
                    log('é—®å·é¡µé¢å·²æ‰“å¼€ï¼Œè¯·ç­‰å¾…åŠ è½½...', 'success');
                    
                    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                    const btn = document.getElementById('btnStart');
                    const loading = btn.querySelector('.loading');
                    btn.disabled = true;
                    loading.style.display = 'inline-block';
                    btn.innerHTML = '<span class="loading"></span> ç­‰å¾…é¡µé¢åŠ è½½...';
                    
                } else {
                    log('æ‰“å¼€é—®å·é¡µé¢å¤±è´¥', 'error');
                }
            } catch (error) {
                log(`æ‰“å¼€é¡µé¢å‡ºé”™: ${error.message}`, 'error');
            }
        }
        
        // å¼€å§‹è‡ªåŠ¨ç­”é¢˜
        async function startAutoAnswer() {
            log('æ­£åœ¨å¼€å§‹è‡ªåŠ¨ç­”é¢˜...', 'info');
            
            try {
                // æ³¨å…¥ç­”é¢˜è„šæœ¬
                const result = await window.electronAPI.injectScript('if (window.startAutoAnswer) window.startAutoAnswer();');
                if (result.success) {
                    log('å·²è§¦å‘è‡ªåŠ¨ç­”é¢˜ï¼Œè¯·æŸ¥çœ‹é—®å·é¡µé¢', 'success');
                } else {
                    log(`è§¦å‘ç­”é¢˜å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                log(`å¯åŠ¨å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const statusContent = document.getElementById('statusContent');
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent = `[${timestamp}] ${message}`;
            
            statusContent.appendChild(logDiv);
            statusContent.scrollTop = statusContent.scrollHeight;
        }
        
        // æ¸…ç©ºæ—¥å¿—
        window.clearLogs = function() {
            document.getElementById('statusContent').innerHTML = '';
            log('æ—¥å¿—å·²æ¸…ç©º', 'info');
        };
    </script>
</body>
</html>